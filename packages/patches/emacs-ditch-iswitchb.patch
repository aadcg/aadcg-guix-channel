From b8e49e187f36e0799a7d311e28a1e64ab192464c Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andr=C3=A9=20A=2E=20Gomes?= <andremegafone@gmail.com>
Date: Mon, 12 Sep 2022 20:43:32 +0300
Subject: [PATCH] Get rid of references to iswitchb.

---
 lisp/gnus/gnus-util.el | 38 +-------------------------------------
 lisp/isearchb.el       |  4 ++--
 2 files changed, 3 insertions(+), 39 deletions(-)

diff --git a/lisp/gnus/gnus-util.el b/lisp/gnus/gnus-util.el
index 662817255bb..95ca8558dd4 100644
--- a/lisp/gnus/gnus-util.el
+++ b/lisp/gnus/gnus-util.el
@@ -47,10 +47,7 @@
                  gnus-emacs-completing-read)
 		(function-item
 		 :doc "Use `ido-completing-read' function."
-		 gnus-ido-completing-read)
-		(function-item
-		 :doc "Use iswitchb based completing-read function."
-		 gnus-iswitchb-completing-read)))
+		 gnus-ido-completing-read)))
 
 (defcustom gnus-completion-styles
   (append (when (and (assq 'substring completion-styles-alist)
@@ -1329,39 +1326,6 @@ SPEC is a predicate specifier that contains stuff like `or', `and',
   (ido-completing-read prompt collection nil require-match
 		       initial-input history def))
 
-
-(declare-function iswitchb-read-buffer "iswitchb"
-		  (prompt &optional default require-match
-			  _predicate start matches-set))
-(declare-function iswitchb-minibuffer-setup "iswitchb")
-(defvar iswitchb-temp-buflist)
-(defvar iswitchb-mode)
-(defvar iswitchb-make-buflist-hook)
-
-(defun gnus-iswitchb-completing-read (prompt collection &optional require-match
-                                            initial-input history def)
-  "`iswitchb' based completing-read function."
-  ;; Make sure iswitchb is loaded before we let-bind its variables.
-  ;; If it is loaded inside the let, variables can become unbound afterwards.
-  (require 'iswitchb)
-  (let ((iswitchb-make-buflist-hook
-         (lambda ()
-           (setq iswitchb-temp-buflist
-                 (let ((choices (append
-                                 (when initial-input (list initial-input))
-                                 (symbol-value history) collection))
-                       filtered-choices)
-                   (dolist (x choices)
-                     (setq filtered-choices (cl-adjoin x filtered-choices)))
-                   (nreverse filtered-choices))))))
-    (unwind-protect
-        (progn
-          (or iswitchb-mode
-	      (add-hook 'minibuffer-setup-hook #'iswitchb-minibuffer-setup))
-          (iswitchb-read-buffer prompt def require-match))
-      (or iswitchb-mode
-	  (remove-hook 'minibuffer-setup-hook #'iswitchb-minibuffer-setup)))))
-
 (defmacro gnus-parse-without-error (&rest body)
   "Allow continuing onto the next line even if an error occurs."
   (declare (indent 0) (debug t))
diff --git a/lisp/isearchb.el b/lisp/isearchb.el
index d11a5d2537b..ffd2b7c911c 100644
--- a/lisp/isearchb.el
+++ b/lisp/isearchb.el
@@ -77,8 +77,8 @@
 ;;; Code:
 
 ;; FIXME: Don't rely on iswitchb!  See bug#36260.
-(with-suppressed-warnings ((obsolete iswitchb))
-  (require 'iswitchb))
+;; (with-suppressed-warnings ((obsolete iswitchb))
+;;   (require 'iswitchb))
 
 (defgroup isearchb nil
   "Switch between buffers using a mechanism like isearch."
-- 
2.37.3

